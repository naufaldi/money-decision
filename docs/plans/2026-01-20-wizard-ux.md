# Wizard UX Enhancement Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Transform the single-page Money Decision calculator into a focused 4-step wizard with WCAG 2.1 AA accessibility, keyboard navigation, and slide animations.

**Architecture:** Replace `<MoneyCalculator />` with a new `<Wizard />` component that manages step state and renders focused steps one at a time. Each step is a card-based component with validation, accessible input, and navigation controls.

**Tech Stack:** React 18, TypeScript, Tailwind CSS, Framer Motion (for animations), Lucide React (icons), Radix UI (accessible primitives).

---

## Breadcrumb Navigation

```
docs/plans/2026-01-20-wizard-ux.md (this file)
│
├── Phase 1: Foundation
│   ├── Task 1: Create Wizard container
│   ├── Task 2: Create WizardStep wrapper
│   └── Task 3: Create StepIndicators component
│
├── Phase 2: Step Components
│   ├── Task 4: Create Step1Income component
│   ├── Task 5: Create Step2Expenses component
│   ├── Task 6: Create Step3Rule component
│   └── Task 7: Create Step4Results component
│
├── Phase 3: Navigation & State
│   ├── Task 8: Implement wizard state management
│   ├── Task 9: Implement validation logic
│   └── Task 10: Implement navigation controls
│
└── Phase 4: Polish & Accessibility
    ├── Task 11: Add keyboard navigation
    ├── Task 12: Add ARIA attributes
    ├── Task 13: Add CSS animations
    └── Task 14: Update App.tsx to use Wizard
```

---

## Phase 1: Foundation

### Task 1: Create Wizard Container

**Files:**
- Create: `src/components/wizard/Wizard.tsx`
- Modify: `src/types/index.ts`
- Test: `src/components/wizard/Wizard.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Wizard } from './Wizard';

describe('Wizard', () => {
  it('renders step 1 by default', () => {
    render(<Wizard />);
    expect(screen.getByText('Enter Your Income')).toBeInTheDocument();
  });

  it('shows step indicator with current step', () => {
    render(<Wizard />);
    const indicators = screen.getAllByRole('button', { name: /step/i });
    expect(indicators).toHaveLength(4);
  });

  it('does not show back button on step 1', () => {
    render(<Wizard />);
    expect(screen.queryByRole('button', { name: /back/i })).not.toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.test.tsx -v`
Expected: FAIL - "Wizard" is not defined

**Step 3: Write minimal implementation**

```tsx
import { useState } from 'react';
import { StepIndicators } from './StepIndicators';
import { Step1Income } from './Step1Income';
import { Step2Expenses } from './Step2Expenses';
import { Step3Rule } from './Step3Rule';
import { Step4Results } from './Step4Results';

interface WizardState {
  currentStep: number;
  income: number | null;
  expenses: number | null;
  selectedRuleId: string;
  riskProfile: 'passive' | 'moderate' | 'active';
}

const initialState: WizardState = {
  currentStep: 1,
  income: null,
  expenses: null,
  selectedRuleId: '60-30-10',
  riskProfile: 'passive',
};

export function Wizard() {
  const [state, setState] = useState<WizardState>(initialState);

  const renderStep = () => {
    switch (state.currentStep) {
      case 1:
        return <Step1Income value={state.income} onChange={(v) => setState({ ...state, income: v })} />;
      case 2:
        return <Step2Expenses value={state.expenses} onChange={(v) => setState({ ...state, expenses: v })} />;
      case 3:
        return <Step3Rule selected={state.selectedRuleId} onChange={(v) => setState({ ...state, selectedRuleId: v })} />;
      case 4:
        return <Step4Results data={state} />;
      default:
        return null;
    }
  };

  return (
    <div role="main" aria-label="Money Decision Wizard" className="wizard-container">
      <StepIndicators current={state.currentStep} total={4} />
      {renderStep()}
    </div>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Wizard.tsx src/components/wizard/Wizard.test.tsx
git commit -m "feat: create Wizard container component"
```

---

### Task 2: Create WizardStep Wrapper

**Files:**
- Create: `src/components/wizard/WizardStep.tsx`
- Test: `src/components/wizard/WizardStep.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { WizardStep } from './WizardStep';

describe('WizardStep', () => {
  it('renders step title', () => {
    render(
      <WizardStep title="Test Step" stepNumber={2} totalSteps={4}>
        <p>Step content</p>
      </WizardStep>
    );
    expect(screen.getByText('Test Step')).toBeInTheDocument();
  });

  it('applies slide-in animation class', () => {
    render(
      <WizardStep title="Test" stepNumber={1} totalSteps={4}>
        <p>Content</p>
      </WizardStep>
    );
    const container = screen.getByRole('article');
    expect(container).toHaveClass('step-enter');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/WizardStep.test.tsx -v`
Expected: FAIL - "WizardStep" is not defined

**Step 3: Write minimal implementation**

```tsx
import { ReactNode } from 'react';

interface WizardStepProps {
  children: ReactNode;
  title: string;
  stepNumber: number;
  totalSteps: number;
}

export function WizardStep({ children, title, stepNumber, totalSteps }: WizardStepProps) {
  return (
    <article 
      role="group" 
      aria-labelledby={`step-title-${stepNumber}`}
      className="wizard-step step-enter"
    >
      <h2 id={`step-title-${stepNumber}`} className="sr-only">
        Step {stepNumber} of {totalSteps}: {title}
      </h2>
      {children}
    </article>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/WizardStep.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/WizardStep.tsx src/components/wizard/WizardStep.test.tsx
git commit -m "feat: create WizardStep wrapper component"
```

---

### Task 3: Create StepIndicators Component

**Files:**
- Create: `src/components/wizard/StepIndicators.tsx`
- Test: `src/components/wizard/StepIndicators.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { StepIndicators } from './StepIndicators';

describe('StepIndicators', () => {
  it('renders 4 step indicators', () => {
    render(<StepIndicators current={1} total={4} />);
    const buttons = screen.getAllByRole('button');
    expect(buttons).toHaveLength(4);
  });

  it('marks current step as active', () => {
    render(<StepIndicators current={2} total={4} />);
    const activeButton = screen.getByRole('button', { name: /step 2/i });
    expect(activeButton).toHaveAttribute('aria-current', 'step');
  });

  it('marks completed steps as checked', () => {
    render(<StepIndicators current={3} total={4} />);
    const completedButton = screen.getByRole('button', { name: /step 1 completed/i });
    expect(completedButton).toHaveAttribute('aria-label', 'Step 1 completed');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/StepIndicators.test.tsx -v`
Expected: FAIL - "StepIndicators" is not defined

**Step 3: Write minimal implementation**

```tsx
import { Check } from 'lucide-react';

interface StepIndicatorsProps {
  current: number;
  total: number;
}

export function StepIndicators({ current, total }: StepIndicatorsProps) {
  return (
    <nav aria-label="Progress" className="step-indicators" role="navigation">
      <ol className="flex items-center justify-center gap-2" role="list">
        {Array.from({ length: total }, (_, i) => {
          const step = i + 1;
          const isCompleted = step < current;
          const isCurrent = step === current;
          const isPending = step > current;

          return (
            <li key={step} className="step-item">
              {isCompleted ? (
                <button
                  type="button"
                  role="button"
                  aria-label={`Step ${step} completed`}
                  className="step-indicator completed"
                  disabled
                >
                  <Check className="w-4 h-4" aria-hidden="true" />
                </button>
              ) : isCurrent ? (
                <button
                  type="button"
                  aria-current="step"
                  className="step-indicator current"
                >
                  <span className="sr-only">Current Step: </span>
                  {step}
                </button>
              ) : (
                <span
                  role="presentation"
                  className="step-indicator pending"
                  aria-hidden="true"
                >
                  {step}
                </span>
              )}
            </li>
          );
        })}
      </ol>
    </nav>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/StepIndicators.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/StepIndicators.tsx src/components/wizard/StepIndicators.test.tsx
git commit -m "feat: create StepIndicators progress component"
```

---

## Phase 2: Step Components

### Task 4: Create Step1Income Component

**Files:**
- Create: `src/components/wizard/Step1Income.tsx`
- Modify: `src/components/ui/input.tsx` (add error state)
- Test: `src/components/wizard/Step1Income.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Step1Income } from './Step1Income';

describe('Step1Income', () => {
  it('renders income input field', () => {
    render(<Step1Income value={null} onChange={() => {}} />);
    expect(screen.getByLabelText(/monthly income/i)).toBeInTheDocument();
  });

  it('shows error when value is 0 on blur', async () => {
    render(<Step1Income value={0} onChange={() => {}} />);
    const input = screen.getByLabelText(/monthly income/i);
    fireEvent.blur(input);
    expect(await screen.findByText(/please enter a valid amount/i)).toBeInTheDocument();
  });

  it('formats value as currency on blur', () => {
    const handleChange = vi.fn();
    render(<Step1Income value={1000000} onChange={handleChange} />);
    const input = screen.getByLabelText(/monthly income/i);
    expect(input).toHaveValue('Rp 1.000.000');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Step1Income.test.tsx -v`
Expected: FAIL - "Step1Income" is not defined

**Step 3: Write minimal implementation**

```tsx
import { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { formatCurrency } from '@/utils/formatters';

interface Step1IncomeProps {
  value: number | null;
  onChange: (value: number) => void;
}

export function Step1Income({ value, onChange }: Step1IncomeProps) {
  const [displayValue, setDisplayValue] = useState(formatCurrency(value || 0));
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (value && value > 0) {
      setDisplayValue(formatCurrency(value));
    }
  }, [value]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const numericString = e.target.value.replace(/[^0-9]/g, '');
    const rawValue = parseInt(numericString, 10) || 0;
    setDisplayValue(e.target.value);
    onChange(rawValue);
    if (error) setError(null);
  };

  const handleBlur = () => {
    const numericValue = parseInt(displayValue.replace(/[^0-9]/g, '') || '0', 10);
    if (!numericValue || numericValue <= 0) {
      setError('Please enter a valid amount greater than 0');
    } else {
      setDisplayValue(formatCurrency(numericValue));
    }
  };

  return (
    <Card className="wizard-card">
      <CardHeader>
        <CardTitle className="text-center">Enter Your Income</CardTitle>
        <CardDescription className="text-center">Enter your monthly take-home income</CardDescription>
      </CardHeader>
      <CardContent>
        <div className="relative">
          <span className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
            Rp
          </span>
          <Input
            type="text"
            aria-label="Monthly income"
            aria-describedby={error ? 'income-error' : undefined}
            aria-invalid={error ? true : undefined}
            value={displayValue}
            onChange={handleChange}
            onBlur={handleBlur}
            placeholder="0"
            className="pl-8 text-lg font-semibold"
          />
        </div>
        {error && (
          <p id="income-error" role="alert" className="text-sm text-destructive mt-2">
            {error}
          </p>
        )}
      </CardContent>
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Step1Income.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Step1Income.tsx src/components/wizard/Step1Income.test.tsx
git commit -m "feat: create Step1Income component with validation"
```

---

### Task 5: Create Step2Expenses Component

**Files:**
- Create: `src/components/wizard/Step2Expenses.tsx`
- Test: `src/components/wizard/Step2Expenses.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Step2Expenses } from './Step2Expenses';

describe('Step2Expenses', () => {
  it('renders optional expenses input', () => {
    render(<Step2Expenses value={null} onChange={() => {}} />);
    expect(screen.getByText(/monthly expenses/i)).toBeInTheDocument();
    expect(screen.getByText(/\(optional\)/i)).toBeInTheDocument();
  });

  it('shows warning when expenses exceed income', () => {
    render(<Step2Expenses value={2000000} onChange={() => {}} income={1000000} />);
    expect(screen.getByText(/expenses exceed income/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Step2Expenses.test.tsx -v`
Expected: FAIL - "Step2Expenses" is not defined

**Step 3: Write minimal implementation**

```tsx
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { formatCurrency } from '@/utils/formatters';
import { useState, useEffect } from 'react';

interface Step2ExpensesProps {
  value: number | null;
  onChange: (value: number) => void;
  income?: number;
}

export function Step2Expenses({ value, onChange, income }: Step2ExpensesProps) {
  const [displayValue, setDisplayValue] = useState(formatCurrency(value || 0));
  const [warning, setWarning] = useState<string | null>(null);

  useEffect(() => {
    if (value && value > 0) {
      setDisplayValue(formatCurrency(value));
    }
  }, [value]);

  useEffect(() => {
    if (income && value && value > income) {
      setWarning('Expenses exceed your income');
    } else {
      setWarning(null);
    }
  }, [income, value]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const numericString = e.target.value.replace(/[^0-9]/g, '');
    const rawValue = parseInt(numericString, 10) || 0;
    setDisplayValue(e.target.value);
    onChange(rawValue);
  };

  return (
    <Card className="wizard-card">
      <CardHeader>
        <CardTitle className="text-center">Monthly Expenses (Optional)</CardTitle>
        <CardDescription className="text-center">For more accurate emergency fund calculations</CardDescription>
      </CardHeader>
      <CardContent>
        <div className="relative">
          <span className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
            Rp
          </span>
          <Input
            type="text"
            aria-label="Monthly expenses"
            value={displayValue}
            onChange={handleChange}
            placeholder="Enter monthly expenses"
            className="pl-8"
          />
        </div>
        {warning && (
          <p role="alert" className="text-sm text-amber-600 mt-2">
            {warning}
          </p>
        )}
      </CardContent>
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Step2Expenses.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Step2Expenses.tsx src/components/wizard/Step2Expenses.test.tsx
git commit -m "feat: create Step2Expenses component"
```

---

### Task 6: Create Step3Rule Component

**Files:**
- Create: `src/components/wizard/Step3Rule.tsx`
- Test: `src/components/wizard/Step3Rule.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Step3Rule } from './Step3Rule';

describe('Step3Rule', () => {
  it('renders rule options as radio buttons', () => {
    render(<Step3Rule selected="60-30-10" onChange={() => {}} />);
    expect(screen.getByRole('radio', { name: /60\/30\/10/i })).toBeInTheDocument();
    expect(screen.getByRole('radio', { name: /50\/30\/20/i })).toBeInTheDocument();
  });

  it('calls onChange when selection changes', () => {
    const handleChange = vi.fn();
    render(<Step3Rule selected="60-30-10" onChange={handleChange} />);
    fireEvent.click(screen.getByRole('radio', { name: /50\/30\/20/i }));
    expect(handleChange).toHaveBeenCalledWith('50-30-20');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Step3Rule.test.tsx -v`
Expected: FAIL - "Step3Rule" is not defined

**Step 3: Write minimal implementation**

```tsx
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';

interface Step3RuleProps {
  selected: string;
  onChange: (value: string) => void;
}

const RULES = [
  { id: '60-30-10', name: '60/30/10', description: 'Recommended for beginners' },
  { id: '50-30-20', name: '50/30/20', description: 'Balanced approach' },
  { id: '70-20-10', name: '70/20/10', description: 'Higher lifestyle allocation' },
];

export function Step3Rule({ selected, onChange }: Step3RuleProps) {
  return (
    <Card className="wizard-card">
      <CardHeader>
        <CardTitle className="text-center">Select Your Budget Rule</CardTitle>
        <CardDescription className="text-center">Choose the allocation strategy that fits your goals</CardDescription>
      </CardHeader>
      <CardContent>
        <fieldset className="space-y-3">
          <legend className="sr-only">Choose a budget rule</legend>
          {RULES.map((rule) => (
            <label
              key={rule.id}
              className={`flex items-center p-4 border rounded-lg cursor-pointer transition-colors ${
                selected === rule.id
                  ? 'border-primary bg-primary/5'
                  : 'border-border hover:bg-muted'
              }`}
            >
              <input
                type="radio"
                name="budget-rule"
                value={rule.id}
                checked={selected === rule.id}
                onChange={(e) => onChange(e.target.value)}
                className="sr-only"
                aria-describedby={`${rule.id}-description`}
              />
              <span className="font-medium mr-3">{rule.name}</span>
              <span id={`${rule.id}-description`} className="text-muted-foreground text-sm">
                {rule.description}
              </span>
            </label>
          ))}
        </fieldset>
      </CardContent>
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Step3Rule.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Step3Rule.tsx src/components/wizard/Step3Rule.test.tsx
git commit -m "feat: create Step3Rule component"
```

---

### Task 7: Create Step4Results Component

**Files:**
- Create: `src/components/wizard/Step4Results.tsx`
- Modify: `src/utils/calculators.ts` (reuse existing logic)
- Test: `src/components/wizard/Step4Results.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Step4Results } from './Step4Results';

describe('Step4Results', () => {
  it('renders allocation breakdown', () => {
    render(
      <Step4Results
        data={{
          currentStep: 4,
          income: 10000000,
          expenses: 6000000,
          selectedRuleId: '60-30-10',
          riskProfile: 'passive',
        }}
      />
    );
    expect(screen.getByText(/daily life/i)).toBeInTheDocument();
    expect(screen.getByText(/savings/i)).toBeInTheDocument();
    expect(screen.getByText(/investment/i)).toBeInTheDocument();
  });

  it('shows formatted currency values', () => {
    render(
      <Step4Results
        data={{
          currentStep: 4,
          income: 10000000,
          expenses: 6000000,
          selectedRuleId: '60-30-10',
          riskProfile: 'passive',
        }}
      />
    );
    expect(screen.getByText(/6\.000\.000/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Step4Results.test.tsx -v`
Expected: FAIL - "Step4Results" is not defined

**Step 3: Write minimal implementation**

```tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { useMemo } from 'react';
import { calculateResults } from '@/utils/calculators';
import { Calculator as CalculatorIcon } from 'lucide-react';

interface Step4ResultsProps {
  data: {
    income: number | null;
    expenses: number | null;
    selectedRuleId: string;
    riskProfile: 'passive' | 'moderate' | 'active';
  };
}

export function Step4Results({ data }: Step4ResultsProps) {
  const results = useMemo(() => {
    if (!data.income || data.income <= 0) return null;
    const estimatedExpenses = data.expenses || data.income * 0.7 * 0.6;
    return calculateResults(data.income, data.selectedRuleId, data.riskProfile, estimatedExpenses);
  }, [data]);

  if (!results) return null;

  const { allocation, savingsBreakdown, investmentBreakdown } = results;

  return (
    <div className="space-y-6">
      <div className="text-center space-y-2">
        <h1 className="text-3xl font-bold flex items-center justify-center gap-2">
          <CalculatorIcon className="w-8 h-8 text-primary" />
          Money Decision
        </h1>
        <p className="text-muted-foreground">Your personalized budget allocation</p>
      </div>

      <Card>
        <CardHeader>
          <CardTitle className="text-center">Daily Life ({allocation.needs}%)</CardTitle>
        </CardHeader>
        <CardContent className="text-center">
          <p className="text-2xl font-bold">Rp {allocation.needsAmount.toLocaleString('id-ID')}</p>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle className="text-center">Savings ({allocation.savings}%)</CardTitle>
        </CardHeader>
        <CardContent className="text-center">
          <p className="text-2xl font-bold">Rp {allocation.savingsAmount.toLocaleString('id-ID')}</p>
          <p className="text-sm text-muted-foreground mt-2">
            Emergency Fund Target: Rp {savingsBreakdown.emergencyFundTarget.toLocaleString('id-ID')}
          </p>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle className="text-center">Investment ({allocation.wants}%)</CardTitle>
        </CardHeader>
        <CardContent className="text-center">
          <p className="text-2xl font-bold">Rp {allocation.wantsAmount.toLocaleString('id-ID')}</p>
          <div className="mt-4 space-y-2">
            {investmentBreakdown.recommendations.map((rec) => (
              <p key={rec.name} className="text-sm">
                {rec.percentage}% {rec.name}
              </p>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Step4Results.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Step4Results.tsx src/components/wizard/Step4Results.test.tsx
git commit -m "feat: create Step4Results component"
```

---

## Phase 3: Navigation & State

### Task 8: Implement Wizard State Management

**Files:**
- Modify: `src/components/wizard/Wizard.tsx`
- Test: `src/components/wizard/Wizard.state.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Wizard } from './Wizard';

describe('Wizard State', () => {
  it('navigates to step 2 when Continue is clicked', async () => {
    render(<Wizard />);
    const continueButton = screen.getByRole('button', { name: /continue/i });
    fireEvent.click(continueButton);
    expect(await screen.findByText(/monthly expenses/i)).toBeInTheDocument();
  });

  it('navigates back to step 1 when Back is clicked', () => {
    render(<Wizard />);
    // Advance to step 2
    const continueButton = screen.getByRole('button', { name: /continue/i });
    fireEvent.click(continueButton);
    // Go back
    const backButton = screen.getByRole('button', { name: /back/i });
    fireEvent.click(backButton);
    expect(screen.getByText(/enter your income/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.state.test.tsx -v`
Expected: FAIL - tests fail due to missing navigation

**Step 3: Write minimal implementation**

```tsx
import { useState, useCallback } from 'react';
import { StepIndicators } from './StepIndicators';
import { Step1Income } from './Step1Income';
import { Step2Expenses } from './Step2Expenses';
import { Step3Rule } from './Step3Rule';
import { Step4Results } from './Step4Results';
import { Button } from '@/components/ui/button';
import { ArrowLeft, ArrowRight } from 'lucide-react';

interface WizardState {
  currentStep: number;
  income: number | null;
  expenses: number | null;
  selectedRuleId: string;
  riskProfile: 'passive' | 'moderate' | 'active';
}

const initialState: WizardState = {
  currentStep: 1,
  income: null,
  expenses: null,
  selectedRuleId: '60-30-10',
  riskProfile: 'passive',
};

export function Wizard() {
  const [state, setState] = useState<WizardState>(initialState);

  const canProceed = useCallback(() => {
    switch (state.currentStep) {
      case 1:
        return state.income !== null && state.income > 0;
      case 2:
        return true; // Optional step
      case 3:
        return !!state.selectedRuleId;
      default:
        return true;
    }
  }, [state]);

  const handleNext = useCallback(() => {
    if (canProceed() && state.currentStep < 4) {
      setState((s) => ({ ...s, currentStep: s.currentStep + 1 }));
    }
  }, [state.currentStep, canProceed]);

  const handleBack = useCallback(() => {
    if (state.currentStep > 1) {
      setState((s) => ({ ...s, currentStep: s.currentStep - 1 }));
    }
  }, [state.currentStep]);

  const renderStep = () => {
    switch (state.currentStep) {
      case 1:
        return (
          <Step1Income
            value={state.income}
            onChange={(v) => setState((s) => ({ ...s, income: v }))}
          />
        );
      case 2:
        return (
          <Step2Expenses
            value={state.expenses}
            income={state.income || undefined}
            onChange={(v) => setState((s) => ({ ...s, expenses: v }))}
          />
        );
      case 3:
        return (
          <Step3Rule
            selected={state.selectedRuleId}
            onChange={(v) => setState((s) => ({ ...s, selectedRuleId: v }))}
          />
        );
      case 4:
        return <Step4Results data={state} />;
      default:
        return null;
    }
  };

  return (
    <div role="main" aria-label="Money Decision Wizard" className="wizard-container">
      <StepIndicators current={state.currentStep} total={4} />
      {renderStep()}
      {state.currentStep < 4 && (
        <div className="flex justify-between mt-6">
          <Button
            variant="outline"
            onClick={handleBack}
            disabled={state.currentStep === 1}
            className="gap-2"
          >
            <ArrowLeft className="w-4 h-4" />
            Back
          </Button>
          <Button onClick={handleNext} disabled={!canProceed()} className="gap-2">
            Continue
            <ArrowRight className="w-4 h-4" />
          </Button>
        </div>
      )}
    </div>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.state.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Wizard.tsx
git commit -m "feat: implement wizard state and navigation"
```

---

### Task 9: Implement Validation Logic

**Files:**
- Create: `src/components/wizard/useWizardValidation.ts`
- Test: `src/components/wizard/useWizardValidation.test.ts`

**Step 1: Write the failing test**

```tsx
import { renderHook, act } from '@testing-library/react';
import { useWizardValidation } from './useWizardValidation';

describe('useWizardValidation', () => {
  it('returns isValid: false for step 1 with no income', () => {
    const { result } = renderHook(() => useWizardValidation(1, null));
    expect(result.current.isValid).toBe(false);
  });

  it('returns isValid: true for step 1 with valid income', () => {
    const { result } = renderHook(() => useWizardValidation(1, 1000000));
    expect(result.current.isValid).toBe(true);
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/useWizardValidation.test.ts -v`
Expected: FAIL - "useWizardValidation" is not defined

**Step 3: Write minimal implementation**

```ts
export function useWizardValidation(step: number, value: number | null | string) {
  const isValid = (() => {
    switch (step) {
      case 1:
        return typeof value === 'number' && value > 0;
      case 2:
        return true; // Optional
      case 3:
        return typeof value === 'string' && value.length > 0;
      default:
        return true;
    }
  })();

  const error = (() => {
    if (isValid) return null;
    switch (step) {
      case 1:
        return 'Please enter a valid amount greater than 0';
      case 3:
        return 'Please select a budget rule';
      default:
        return 'This field is required';
    }
  })();

  return { isValid, error };
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/useWizardValidation.test.ts -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/useWizardValidation.ts src/components/wizard/useWizardValidation.test.ts
git commit -m "feat: add wizard validation hook"
```

---

### Task 10: Implement Navigation Controls

**Files:**
- Modify: `src/components/wizard/Wizard.tsx` (add keyboard shortcuts)
- Test: `src/components/wizard/Wizard.keyboard.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Wizard } from './Wizard';
import userEvent from '@testing-library/user-event';

describe('Wizard Keyboard Navigation', () => {
  it('advances with Enter key', async () => {
    const user = userEvent.setup();
    render(<Wizard />);
    await user.keyboard('{Enter}');
    expect(await screen.findByText(/monthly expenses/i)).toBeInTheDocument();
  });

  it('goes back with ArrowLeft key', async () => {
    const user = userEvent.setup();
    render(<Wizard />);
    // Advance to step 2
    await user.keyboard('{Enter}');
    // Go back
    await user.keyboard('{ArrowLeft}');
    expect(screen.getByText(/enter your income/i)).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.keyboard.test.tsx -v`
Expected: FAIL - keyboard navigation not implemented

**Step 3: Write minimal implementation**

```tsx
import { useEffect, useCallback } from 'react';

export function useWizardKeyboard(
  currentStep: number,
  onNext: () => void,
  onBack: () => void,
  canProceed: boolean,
  isResults: boolean
) {
  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (isResults) return;

      if (e.key === 'Enter' && canProceed && !e.shiftKey) {
        e.preventDefault();
        onNext();
      } else if (e.key === 'ArrowLeft' && e.shiftKey) {
        e.preventDefault();
        if (currentStep > 1) onBack();
      }
    },
    [currentStep, onNext, onBack, canProceed, isResults]
  );

  useEffect(() => {
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [handleKeyDown]);
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.keyboard.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/useWizardKeyboard.ts src/components/wizard/Wizard.keyboard.test.tsx
git commit -m "feat: add keyboard navigation support"
```

---

## Phase 4: Polish & Accessibility

### Task 11: Add Keyboard Navigation

**Files:**
- Modify: `src/components/wizard/Wizard.tsx` (integrate keyboard)
- Modify: `src/components/wizard/Step1Income.tsx` (auto-focus)
- Test: `src/components/wizard/Wizard.a11y.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Wizard } from './Wizard';

describe('Wizard Accessibility', () => {
  it('auto-focuses input on step mount', () => {
    render(<Wizard />);
    const input = screen.getByLabelText(/monthly income/i);
    expect(input).toHaveFocus();
  });

  it('announces step change to screen readers', () => {
    render(<Wizard />);
    const liveRegion = screen.getByRole('status');
    expect(liveRegion).toHaveAttribute('aria-live', 'polite');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.a11y.test.tsx -v`
Expected: FAIL - accessibility features not implemented

**Step 3: Write minimal implementation**

```tsx
import { useEffect, useRef } from 'react';

export function useAutoFocus(condition: boolean) {
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (condition && inputRef.current) {
      inputRef.current.focus();
    }
  }, [condition]);

  return inputRef;
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.a11y.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/useAutoFocus.ts src/components/wizard/Wizard.a11y.test.tsx
git commit -m "feat: add auto-focus for accessibility"
```

---

### Task 12: Add ARIA Attributes

**Files:**
- Modify: `src/components/wizard/Wizard.tsx` (add live region)
- Modify: `src/components/wizard/Step1Income.tsx` (add aria-invalid)
- Test: `src/components/wizard/Wizard.aria.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Wizard } from './Wizard';

describe('ARIA Attributes', () => {
  it('has live region for step announcements', () => {
    render(<Wizard />);
    const liveRegion = screen.getByRole('log');
    expect(liveRegion).toHaveAttribute('aria-live', 'polite');
  });

  it('marks invalid input with aria-invalid', () => {
    render(<Wizard />);
    const input = screen.getByLabelText(/monthly income/i);
    expect(input).toHaveAttribute('aria-invalid', 'false');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.aria.test.tsx -v`
Expected: FAIL - ARIA attributes missing

**Step 3: Write minimal implementation**

```tsx
// Add to Wizard.tsx render:
<div aria-live="polite" aria-atomic="true" className="sr-only">
  {currentStep === 1 && 'Step 1 of 4: Enter your income'}
  {currentStep === 2 && 'Step 2 of 4: Enter your monthly expenses'}
  {currentStep === 3 && 'Step 3 of 4: Select your budget rule'}
  {currentStep === 4 && 'Step 4 of 4: Your financial plan'}
</div>
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.aria.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/Wizard.aria.test.tsx
git commit -m "feat: add ARIA live regions"
```

---

### Task 13: Add CSS Animations

**Files:**
- Create: `src/components/wizard/wizard.css`
- Modify: `src/index.css` (import wizard styles)
- Test: `src/components/wizard/Wizard.animations.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import { Wizard } from './Wizard';

describe('CSS Animations', () => {
  it('applies slide-in animation class', () => {
    render(<Wizard />);
    const step = screen.getByRole('article');
    expect(step).toHaveClass('animate-slide-in');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/components/wizard/Wizard.animations.test.tsx -v`
Expected: FAIL - animation classes not defined

**Step 3: Write minimal implementation**

```css
.wizard-container {
  max-width: 480px;
  margin: 0 auto;
}

.wizard-card {
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    transform: translateX(20px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(-20px);
    opacity: 0;
  }
}

.step-enter {
  animation: slideIn 0.3s ease-out;
}

.step-exit {
  animation: slideOut 0.2s ease-in;
}

@media (prefers-reduced-motion: reduce) {
  .step-enter,
  .step-exit {
    animation: none;
  }
}
```

**Step 4: Run test to verify it passes**

Run: `npm test src/components/wizard/Wizard.animations.test.tsx -v`
Expected: PASS

**Step 5: Commit**

```bash
git add src/components/wizard/wizard.css
git commit -m "feat: add wizard CSS animations"
```

---

### Task 14: Update App.tsx to Use Wizard

**Files:**
- Modify: `src/App.tsx`
- Test: `src/App.test.tsx`

**Step 1: Write the failing test**

```tsx
import { render, screen } from '@testing-library/react';
import App from './App';

describe('App', () => {
  it('renders Wizard component', () => {
    render(<App />);
    expect(screen.getByRole('main')).toHaveAttribute('aria-label', 'Money Decision Wizard');
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test src/App.test.tsx -v`
Expected: FAIL - App doesn't render Wizard yet

**Step 3: Write minimal implementation**

```tsx
import { Wizard } from '@/components/wizard/Wizard';

function App() {
  return (
    <div className="min-h-screen bg-background">
      <main className="container mx-auto py-8 px-4 max-w-2xl">
        <Wizard />
      </main>
    </div>
  );
}

export default App;
```

**Step 4: Run test to verify it passes**

Run: `npm test src/App.test.tsx -v`
Expected: PASS

**Step 5: Run all tests**

Run: `npm test --coverage`
Expected: All tests pass with >80% coverage

**Step 6: Commit**

```bash
git add src/App.tsx
git commit -m "feat: integrate Wizard component into App"
```

**Step 7: Build and verify**

Run: `npm run build`
Expected: Build succeeds with no errors

---

## Plan Complete

**Plan saved to:** `docs/plans/2026-01-20-wizard-ux.md`

### Two Execution Options:

**1. Subagent-Driven (this session)** - I dispatch fresh subagent per task, review between tasks, fast iteration

**2. Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

**Which approach?**

---

## Estimated Effort

| Phase | Tasks | Time Estimate |
|-------|-------|---------------|
| Phase 1: Foundation | 3 | 15-20 minutes |
| Phase 2: Step Components | 4 | 25-30 minutes |
| Phase 3: Navigation & State | 3 | 20-25 minutes |
| Phase 4: Polish & Accessibility | 4 | 20-25 minutes |

**Total: ~90-110 minutes**

## Files Created/Modified

### New Files
- `src/components/wizard/Wizard.tsx`
- `src/components/wizard/Wizard.test.tsx`
- `src/components/wizard/Wizard.state.test.tsx`
- `src/components/wizard/Wizard.keyboard.test.tsx`
- `src/components/wizard/Wizard.a11y.test.tsx`
- `src/components/wizard/Wizard.aria.test.tsx`
- `src/components/wizard/Wizard.animations.test.tsx`
- `src/components/wizard/WizardStep.tsx`
- `src/components/wizard/WizardStep.test.tsx`
- `src/components/wizard/StepIndicators.tsx`
- `src/components/wizard/StepIndicators.test.tsx`
- `src/components/wizard/Step1Income.tsx`
- `src/components/wizard/Step1Income.test.tsx`
- `src/components/wizard/Step2Expenses.tsx`
- `src/components/wizard/Step2Expenses.test.tsx`
- `src/components/wizard/Step3Rule.tsx`
- `src/components/wizard/Step3Rule.test.tsx`
- `src/components/wizard/Step4Results.tsx`
- `src/components/wizard/Step4Results.test.tsx`
- `src/components/wizard/useWizardValidation.ts`
- `src/components/wizard/useWizardValidation.test.ts`
- `src/components/wizard/useWizardKeyboard.ts`
- `src/components/wizard/useAutoFocus.ts`
- `src/components/wizard/wizard.css`

### Modified Files
- `src/App.tsx`
- `src/types/index.ts`
- `src/components/ui/input.tsx`
- `src/index.css`
- `docs/prd-money-decision.md`